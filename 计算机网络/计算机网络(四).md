# 计算机网络(四)：网络层

## 介绍

### 转发和路由选择

网络层的作用看起来很简单，就是把一台主机发送的分组移动到接收分组的机器。其需要如下两种功能。

- **转发**

  路由器必须将分组移动到适当的输出链路

- **路由选择**

  分组在传输的时候，网络层的路由选择算法将决定这些分组采用的路由和路径

### 网络服务模型

对于运输层向网络层传输时所产生的各种问题(连续分组的时间间隔网络层怎么处理；是否反馈网络阻塞信息；...)，可以由网络层提供的服务模型所确定。

- **确保交付**

- **确定时间内交付**

- **有序分组交付**

- **确保最小带宽**

  确定低于带宽的速率传输分组不会丢失

- **确保最大时延抖动**

  发送方的两个相继分组之间的时间量等于接收方它们的时间量(或变化小于某个特定值)

- **安全性服务**

## 虚电路与数据报网络

正如传输层为每个应用提供连接与无连接服务(TCP & UDP)，网络层也提供无连接与有连接服务。在目前世界的网络体系中，网络层只能单一提供其中一种方式，我们将提供连接的服务称为虚电路网络，将提供无连接服务称为数据报网络

### 虚电路网络

仅在网络层提供连接服务的计算机网络

![虚电路](http://qiniu.itliusir.com/%E8%99%9A%E7%BD%91%E7%BB%9C.png)

组成：

1. 源和目的主机之间的路径    

2. VC号(经过路由器会被路由转发表VC替换)

3. 沿着该路径的每台路由器中的转发表表项

阶段：

1. 虚电路建立
2. 数据传送
3. 虚电路拆除

### 数据报网络

![数据报](http://qiniu.itliusir.com/%E6%95%B0%E6%8D%AE%E6%8A%A5%E7%BD%91%E7%BB%9C.png)

仅在网络层提供无连接服务的计算机网络

## 路由器工作原理

如下图在路由器体系结构图

![路由结构](http://qiniu.itliusir.com/%E8%B7%AF%E7%94%B1%E7%BB%93%E6%9E%84.png)

- **输入端口处理**

  ![输入](http://qiniu.itliusir.com/%E8%BE%93%E5%85%A5%E7%AB%AF%E5%8F%A3.png)

- **交换结构**

  如下图为三种交换技术

  ![交换](http://qiniu.itliusir.com/%E4%BA%A4%E6%8D%A2%E6%8A%80%E6%9C%AF.png)

  从输入端口交换到一个输出端口

- **输出端口**

  出路去除存放在输出端口内存中的分组并将其发送到输出链路上

  如下图为输出端口处理

  ![输出](http://qiniu.itliusir.com/%E8%BE%93%E5%87%BA%E7%AB%AF%E5%8F%A3.png)

## IP 协议

### 数据报格式

![数据报格式](http://qiniu.itliusir.com/%E6%95%B0%E6%8D%AE%E6%8A%A5%E6%A0%BC%E5%BC%8F.png)

