# 操作系统(八)：异常控制流

现代系统通过使控制流发生突变来对这些情况(一个硬件定时器定期产生信号、包到达网卡需要存放内存、程序读取磁盘数据等待通知数据已就绪等)作出反应，我们把这些突变称为 **异常控制流(Exceptional Control Flow, ECF)** ，当子进程终止时，创造这些子进程的父进程必须得到通知。

>  作为程序员我们理解ECF可以帮助我们理解程序是如何与操作系统进行交互的。

## 异常

异常是异常控制流的一种形式，一部分交由硬件实现，一部分由操作系统实现。

![](http://qiniu.itliusir.com/exception.png)

在任何情况下，当处理器检测到有事件发生时，会通过一张异常表的跳转表跳转到(间接过程调用)异常处理子程序，异常处理程序完成后会根据异常事件的类型发生如下三种情况：

1. 返回事件发生时正在执行的指令
2. 把控制交给下一个指令
3. 终止被中断的程序

> 如java 提供了应用级 ECF (catch throw try) 

接下来我们来看异常表跳转的细节

首先异常表是一张跳转表，每条都是包含某个异常的处理程序代码地址。异常号是一个唯一的非负整数的数字，一些由处理器设计者分配，另一些由操作系统内核的设计者分配。异常号很关键，它是异常表的索引。

异常表起始地址放在一个特殊CPU寄存器中(异常表基址寄存器)。

### 异常类别

- **中断 (interrupt)** 异步，来自 I/O 设备的信号
- **陷阱 (trap)** 同步，有意的异常
- **故障 (fault)** 同步，潜在可恢复的错误
- **终止 (abort)** 同步，不可恢复的错误

