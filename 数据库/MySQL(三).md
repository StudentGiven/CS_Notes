# 创建高性能索引

## 1. 索引基础

索引有很多种类型，在 MySQL 中索引是存储引擎层而不是服务端实现的，所以不同的存储引擎的索引底层也不同。

### 1.1 B+ Tree 索引

InnoDB 使用的是 B+ Tree 索引，属于 B Tree 的变种。其只在叶子节点存放数据，普通节点只存放k和页号。所以树的高度不会太高，又因为其索引列是顺序组织存储所以很适合范围查找。通过下图可以清晰的看到主键索引和普通索引存储数据的区别，主键索引组织真正的数据，而普通列索引存放的是主键的值，所以查询普通列索引会多一次回表操作(先从普通索引树读到k=3的记录取到主键id为300，然后去主键ID索引树查到对应的值记录R3)。

<img src="http://qiniu.itliusir.com/mysql02.png" style="zoom:50%;" />

### 1.2 hash 索引

hash 索引是基于哈希表实现，只有精确匹配所有列才会精确查询到。MySQL 的 Memory 引擎默认的就是 hash 索引。好处就是查找对比B Tree这种索引速度飞快。

由此可以推导出 hash 索引的一些不足之处：

1. 并不是顺序存储，所以无法排序
2. 不支持部分索引匹配查找
3. 只支持等值查询不支持范围查询
4. hash冲突严重会退化时间复杂度(查找，删除)

## 2. 索引的优点

- **减少查数据的时间**

  例如 B+ Tree 其二分查询只需要寻块几次就可以找到对应数据，减少了整体的查询时间。

- **随机 I/O 变成 顺序 I/O**

  索引列顺序存储

