# 范式与数据类型优化

## 1. 选择优化的数据类型

通常我们会选择尽量小的数据类型、尽量避免NULL、尽量采用简单的数据类型。

例如在选择字符串类型时，我们知道 varchar 类型是可变的，而且是仅使用必要空间，但也会多维护部分(1-2)字节去存储长度信息，可变也会导致页分页产生的开销。而 char 类型是定长的，当列的值基本是同一个长度(例如md5值)，可以采用 char 类型，因为定长不容易产生碎片。

例如在选择日期类型时，我们尽量使用 timestamp，因为它比 datetime 空间效率更高。

## 2. 什么是范式

首先我们来重温下什么是范式，范式可以理解为**表结构所符合某种设计标准级别或者与未来规划预期的程度。**

我们简单介绍几个级别。

<img src="http://qiniu.itliusir.com/mysql_schema01.png" style="zoom:50%;" />

## 3. 范式设计中的问题

- **太多的列**

  MySQL 的服务端与存储引擎之间会通过行缓冲格式 copy 数据，然后服务端把缓冲的内容解码成各列。行转列代价非常高，所以太多的列会导致转换的代价非常高。

- **太多的关联**

  关联表太多会导致解析和优化查询成为问题，如果希望查询执行快且并发性好，单次查询最好在12个表内做关联。

- **枚举的滥用**

  过度使用枚举，例如经常会更新 enum 列的，会导致 alter table 操作(阻塞)。

## 4. 范式与反范式

### 4.1 范式的优点与缺点

范式化设计通常对于写密集的场景比较好。

- 范式化的更新操作比反范式要快
- 范式化修改需要更少的数据
- 范式化的表更小
- 冗余的数据较少

> 缺点：关联更多，代价更大。

### 4.2 反范式的优点与缺点

反范式和范式是相对应的，其优点也即是范式的缺点，其关联少，部分场景效率会更高。

### 4.3 总结

完全的范式化和反范式化都是理想的模型，现实工业场景中没有这么极端的设计，要根据实际的业务场景去混用。